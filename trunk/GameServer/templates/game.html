<html>
<head>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <link href="/css/main.css" rel="stylesheet" type="text/css">
</head>
<body onload="javascript:gameInterface = initialize();"
      onunload="javascript:switchView('loading');">
  <div id="loading" class="display">
    <p>Loading...</p>
  </div>
  
  <div id="game" class="hidden">
    <div id="map"></div>
    <div id="menu">
      <a href="#" onclick="javascript:gameInterface.addFriend();">Add Friend</a>
      <a href="#" onclick="javascript:gameInterface.moveToCurrentLocation();">
        <img src="/res/YourLocationDot.png" width=16 height=16 border=0 />
      </a>
      <a href="#" onclick="javascript:showInstructions();">Instructions</a>
    </div>
  </div>

  <div id="message" style="display: none;">
    <div id="message_background" style="display: none;"></div>
    <div id="message_container" style="display: none;"></div>
  </div>

  <!-- A div to hold the contents of the "instructions" message -->  
  <div id="message_instructions" style="display: none;">
    <a href="#" onclick="javascript:hideMessage();" style="float: right">
      Hide
    </a>
    
    <div>
      <img src="res/icon.png" style="float: left;" width="48" height="48" />
      <h2>Zombie, Run!</h2>
      <h3>Zombie Finder</h3>
      <p>When living in a zombie-infested city, one needs a little help to maintain a normal, healthy,
      and not-undead existence.  The Zombie, Run!&#0153; Zombie Finder is an important surivival tool
      that helps you maintain your normal routine and previous happy lifestyle.  The Zombie,
      Run!&#0153; Zombie Finder shows you the locations of nearby zombies, helping you safely
      navigate an infested area.</p>
      
      <p><i>Instructions for use:</i> When out running an errand or for a walk, start the zombie
      finder, indicate your intended destination, and safely navigate to your destination.</p> 
  
      <p><i>Markers:</i>
        <ul>
          <li><i>Blue Dot</i>: This is your current location.</li>
          <li><i>Blue Person</i>: A beloved friend or family member.</li>
          <li><i>Flag</i>: This is your destination, for ease of reference.</li>
          <li><i>Green Zombie</i>: A zombie who is unaware of your location, and is simply
          meandering about, as zombies do.</li>
          <li><i>Red Zombie</i>: A zombie who is aware of to your location, and is
          hastily making their way towards your tasty, tasty brains.  Try to ensure that you make more
          haste than they do, or you will soon be waste.  Remember: make haste, don't be waste.</li>
        </ul>
      </p>
    </div>
    <div>
      <h2>Additional Information</h2>
      <ul>
        <li><a href="http://www.zrli.org/zombierun/faq.html">Frequently Asked Questions</a></li>
        <li><a href="http://www.zrli.org/zombierun/development.html">Research Materials</a></li>
    </div>
    <div>
      <!-- User Group subscription form -->
      <table border=0 style="background-color: #fff; padding: 5px;" cellspacing=0>
        <tr>
          <td>
            <img src="http://groups.google.com/groups/img/3nb/groups_bar.gif"
                 height=26 width=132 alt="Google Groups">
          </td>
        </tr>
        <tr>
          <td style="padding-left: 5px">
            <b>Subscribe to Zombie, Run! Users to discuss the Zombie, Run! tool, including feature
            requests, usage tips, and general advice on surviving a zombie infestation.</b>
          </td>
        </tr>
        <form action="http://groups.google.com/group/zombie-run-users/boxsubscribe">
          <tr>
            <td style="padding-left: 5px;">
              Email: <input type=text name=email>
              <input type=submit name="sub" value="Subscribe">
            </td>
          </tr>
        </form>
        <tr>
          <td align=right>
            <a href="http://groups.google.com/group/zombie-run-users">Visit this group</a>
          </td>
        </tr>
      </table>
    </div>
  </div>

  <div id="errors" class="hidden">
    The game could not be started because of one of a few errors:
    <ul>
      <li>There were some errors loading the game libraries (try refreshing the
          page).</li>
      <li>Your device does not have a way of determining its location.  Try
          playing the game on one of the known supported devices.</li>
    </ul>
    
    Supported Devices:
    <ul>
      <li>Apple iPhone 3G</li>
      <li>Apple iPhone 3GS</li>
      <li>HTC G1 (T-Mobile G1)</li>
      <li>HTC Hero</li>
      <li>Firefox 3.5</li>
    </ul>
  </div>
  
  <!-- Load these libraries after the message is set up so that users can see
       something while the javascript is loading, which can take some time over
       a mobile connection -->
  <script type="text/javascript" src="http://code.google.com/apis/gears/gears_init.js"></script>
  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
  <script type="text/javascript" src="js/lib/prototype-1.6.0.3.js"></script>
  <script type="text/javascript" src="js/util.js"></script>
  <script type="text/javascript" src="js/entities.js"></script>
  <script type="text/javascript" src="js/game.js"></script>
  <script type="text/javascript" src="js/dom_util.js"></script>
  <script type="text/javascript">
    var gameInterface = null;
    
    function showMessage(message_container_id) {
      $("message").style.width = "100%";
      $("message").style.height = "100%";
      $("message_background").style.display = "block";
      $("message_container").style.display = "block";
      
      $("message_container").innerHTML = $(message_container_id).innerHTML;
    }
    
    function hideMessage() {
      $("message").style.width = 0;
      $("message").style.height = 0;
      $("message_background").style.display = "none";
      $("message_container").style.display = "none";
    }
    
    // Initializes the map and the game, switches the view to the map, starts
    // the game, and returns the game oject.
    function initialize() {
      switchView("game");

      {% if show_instructions %}
        showMessage("message_instructions");
      {% endif %}
      
      var mapOptions = {
        // center: new google.maps.LatLng(0, 0),
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        zoom: 1,
      };
      
      var map = new google.maps.Map(document.getElementById("map"), mapOptions);

      var game = new Game(map, {{ game_id }});
      
      if (game.start()) {
        console.log("Successfully started game.");
      } else {
        console.log("Errors starting the game.");
        switchView("errors");
      }
      
      return game;
    }
    
    function switchView(id) {
      var views = [ "game", "errors", "loading" ];
      var foundElement = false;
      for (i = 0; i < views.length; ++i) {
        element = $(views[i]);
        if (id == element.id) {
          element.className = "display";
          foundElement = true;
        } else {
          element.className = "hidden";
        }
      }
      if (!foundElement) {
        alert("Error in display code.");
      }
    }
  </script>
</body>
